<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Arthur's Enhanced Board</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #0d1117;
      color: #c9d1d9;
      min-height: 100vh;
      padding: 24px;
    }
    
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid #21262d;
    }
    
    h1 {
      font-size: 24px;
      font-weight: 600;
      color: #f0f6fc;
    }
    
    h1 span { color: #f85149; }
    
    .header-controls {
      display: flex;
      gap: 12px;
      align-items: center;
    }
    
    .btn {
      background: #238636;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: background 0.2s;
    }
    
    .btn:hover { background: #2ea043; }
    .btn.secondary { background: #21262d; color: #c9d1d9; }
    .btn.secondary:hover { background: #30363d; }
    
    .updated {
      font-size: 12px;
      color: #8b949e;
    }
    
    .board-container {
      display: flex;
      gap: 16px;
      min-height: calc(100vh - 120px);
    }
    
    .board {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
      flex: 1;
    }
    
    .archive-panel {
      width: 280px;
      background: #161b22;
      border-radius: 8px;
      padding: 12px;
      display: none;
    }
    
    .archive-panel.active { display: block; }
    
    .column {
      background: #161b22;
      border-radius: 8px;
      padding: 12px;
      display: flex;
      flex-direction: column;
    }
    
    .column-header {
      font-size: 14px;
      font-weight: 600;
      color: #f0f6fc;
      margin-bottom: 12px;
      padding: 8px;
      background: #21262d;
      border-radius: 6px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .column-count {
      background: #30363d;
      color: #8b949e;
      font-size: 12px;
      padding: 2px 8px;
      border-radius: 10px;
    }
    
    .tasks {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .task {
      background: #0d1117;
      border: 1px solid #30363d;
      border-radius: 6px;
      padding: 12px;
      cursor: pointer;
      transition: border-color 0.2s, transform 0.2s;
      position: relative;
    }
    
    .task:hover {
      border-color: #58a6ff;
      transform: translateY(-2px);
    }
    
    .task-title {
      font-size: 14px;
      font-weight: 500;
      color: #f0f6fc;
      margin-bottom: 6px;
    }
    
    .task-desc {
      font-size: 12px;
      color: #8b949e;
      margin-bottom: 8px;
      line-height: 1.4;
    }
    
    .task-meta {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    
    .tag {
      font-size: 10px;
      padding: 2px 8px;
      border-radius: 12px;
      font-weight: 500;
    }
    
    .tag.high { background: #f8514922; color: #f85149; }
    .tag.medium { background: #d2992222; color: #d29922; }
    .tag.low { background: #238636aa; color: #3fb950; }
    .tag.recurring { background: #a371f722; color: #a371f7; }
    .tag.project { background: #58a6ff22; color: #58a6ff; }
    
    .task-date {
      font-size: 10px;
      color: #6e7681;
    }
    
    .chat-indicator {
      position: absolute;
      top: 8px;
      right: 8px;
      background: #f85149;
      color: white;
      border-radius: 50%;
      width: 18px;
      height: 18px;
      font-size: 10px;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    /* Enhanced Modal */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.7);
      z-index: 100;
      justify-content: center;
      align-items: center;
    }
    
    .modal-overlay.active { display: flex; }
    
    .modal {
      background: #161b22;
      border: 1px solid #30363d;
      border-radius: 12px;
      width: 90%;
      max-width: 800px;
      max-height: 85vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    
    .modal-header {
      padding: 16px;
      border-bottom: 1px solid #21262d;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .modal-header h2 {
      font-size: 16px;
      color: #f0f6fc;
    }
    
    .modal-close {
      background: none;
      border: none;
      color: #8b949e;
      font-size: 20px;
      cursor: pointer;
    }
    
    .modal-tabs {
      display: flex;
      border-bottom: 1px solid #21262d;
      background: #0d1117;
    }
    
    .tab-btn {
      background: none;
      border: none;
      color: #8b949e;
      padding: 12px 20px;
      cursor: pointer;
      font-size: 14px;
      border-bottom: 2px solid transparent;
      transition: color 0.2s, border-color 0.2s;
    }
    
    .tab-btn.active {
      color: #58a6ff;
      border-bottom-color: #58a6ff;
    }
    
    .tab-content {
      flex: 1;
      overflow-y: auto;
      display: none;
    }
    
    .tab-content.active { display: flex; flex-direction: column; }
    
    .modal-context {
      padding: 16px;
      background: #0d1117;
      border-bottom: 1px solid #21262d;
      font-size: 13px;
      color: #8b949e;
      line-height: 1.5;
    }
    
    .modal-context strong {
      color: #c9d1d9;
    }
    
    .activity-list {
      padding: 16px;
      overflow-y: auto;
    }
    
    .activity-item {
      padding: 12px 0;
      border-bottom: 1px solid #21262d;
    }
    
    .activity-item:last-child { border-bottom: none; }
    
    .activity-header {
      display: flex;
      gap: 12px;
      align-items: flex-start;
    }
    
    .activity-dot {
      width: 8px;
      height: 8px;
      background: #58a6ff;
      border-radius: 50%;
      margin-top: 6px;
      flex-shrink: 0;
    }
    
    .activity-main {
      flex: 1;
    }
    
    .activity-action {
      font-size: 13px;
      color: #f0f6fc;
      font-weight: 500;
    }
    
    .activity-date {
      font-size: 11px;
      color: #6e7681;
      margin-top: 2px;
    }
    
    .activity-detail {
      margin-top: 8px;
      margin-left: 20px;
      padding: 10px 12px;
      background: #0d1117;
      border-left: 2px solid #30363d;
      border-radius: 0 6px 6px 0;
      font-size: 12px;
      color: #8b949e;
      line-height: 1.5;
    }
    
    /* Chat Interface */
    .chat-container {
      display: flex;
      flex-direction: column;
      height: 500px;
    }
    
    .chat-messages {
      flex: 1;
      padding: 16px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .message {
      max-width: 80%;
      padding: 8px 12px;
      border-radius: 12px;
      font-size: 14px;
      line-height: 1.4;
    }
    
    .message.user {
      background: #58a6ff22;
      color: #c9d1d9;
      border: 1px solid #58a6ff44;
      align-self: flex-end;
    }
    
    .message.arthur {
      background: #238636aa;
      color: #c9d1d9;
      border: 1px solid #23863644;
      align-self: flex-start;
    }
    
    .message-time {
      font-size: 10px;
      color: #6e7681;
      margin-top: 4px;
    }
    
    .chat-input-container {
      padding: 16px;
      border-top: 1px solid #21262d;
      background: #0d1117;
    }
    
    .chat-input {
      width: 100%;
      background: #21262d;
      border: 1px solid #30363d;
      border-radius: 6px;
      padding: 8px 12px;
      color: #c9d1d9;
      font-size: 14px;
      resize: vertical;
      min-height: 36px;
      max-height: 120px;
    }
    
    .chat-input:focus {
      outline: none;
      border-color: #58a6ff;
    }
    
    .chat-actions {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-top: 8px;
    }
    
    /* Add Project Form */
    .form-group {
      margin-bottom: 16px;
    }
    
    .form-label {
      display: block;
      font-size: 14px;
      color: #f0f6fc;
      margin-bottom: 6px;
      font-weight: 500;
    }
    
    .form-input, .form-textarea, .form-select {
      width: 100%;
      background: #21262d;
      border: 1px solid #30363d;
      border-radius: 6px;
      padding: 8px 12px;
      color: #c9d1d9;
      font-size: 14px;
    }
    
    .form-textarea {
      min-height: 80px;
      resize: vertical;
    }
    
    .form-input:focus, .form-textarea:focus, .form-select:focus {
      outline: none;
      border-color: #58a6ff;
    }
    
    @media (max-width: 1200px) {
      .board-container {
        flex-direction: column;
      }
      .archive-panel {
        width: 100%;
      }
    }
    
    @media (max-width: 900px) {
      .board {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    
    @media (max-width: 600px) {
      .board {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>ðŸ¦ž <span>Arthur's</span> Enhanced Board</h1>
    <div class="header-controls">
      <button class="btn" onclick="showAddProject()">+ Add Project</button>
      <button class="btn secondary" onclick="toggleArchive()">ðŸ“¦ Archive</button>
      <span class="updated">Last updated: <span id="lastUpdated"></span></span>
    </div>
  </header>
  
  <div class="board-container">
    <div class="board" id="board"></div>
    <div class="archive-panel" id="archivePanel">
      <div class="column-header">
        <span>ðŸ“¦ Archived Projects</span>
        <span class="column-count" id="archiveCount">0</span>
      </div>
      <div class="tasks" id="archivedTasks"></div>
    </div>
  </div>
  
  <!-- Enhanced Modal -->
  <div class="modal-overlay" id="modal">
    <div class="modal">
      <div class="modal-header">
        <h2 id="modalTitle">Project Details</h2>
        <button class="modal-close" onclick="closeModal()">Ã—</button>
      </div>
      <div class="modal-tabs">
        <button class="tab-btn active" onclick="switchTab('activity')">Activity Log</button>
        <button class="tab-btn" onclick="switchTab('chat')">ðŸ’¬ Chat with Arthur</button>
      </div>
      
      <!-- Activity Tab -->
      <div class="tab-content active" id="activityTab">
        <div class="modal-context" id="modalContext"></div>
        <div class="activity-list" id="modalBody"></div>
      </div>
      
      <!-- Chat Tab -->
      <div class="tab-content" id="chatTab">
        <div class="chat-container">
          <div class="chat-messages" id="chatMessages"></div>
          <div class="chat-input-container">
            <textarea class="chat-input" id="chatInput" placeholder="Ask Arthur about this project..." rows="1"></textarea>
            <div class="chat-actions">
              <button class="btn secondary" onclick="clearChat()">Clear</button>
              <button class="btn" onclick="sendMessage()">Send</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Add Project Modal -->
  <div class="modal-overlay" id="addProjectModal">
    <div class="modal">
      <div class="modal-header">
        <h2>Add New Project</h2>
        <button class="modal-close" onclick="closeAddProject()">Ã—</button>
      </div>
      <div class="tab-content active" style="padding: 20px;">
        <form id="addProjectForm">
          <div class="form-group">
            <label class="form-label">Project Title *</label>
            <input type="text" class="form-input" id="projectTitle" required>
          </div>
          <div class="form-group">
            <label class="form-label">Description</label>
            <textarea class="form-textarea" id="projectDesc" placeholder="What is this project about?"></textarea>
          </div>
          <div class="form-group">
            <label class="form-label">Priority</label>
            <select class="form-select" id="projectPriority">
              <option value="high">High</option>
              <option value="medium" selected>Medium</option>
              <option value="low">Low</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Type</label>
            <select class="form-select" id="projectType">
              <option value="project" selected>Project</option>
              <option value="recurring">Recurring Task</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Context (Optional)</label>
            <textarea class="form-textarea" id="projectContext" placeholder="Any background information or context Arthur should know..."></textarea>
          </div>
          <div class="chat-actions">
            <button type="button" class="btn secondary" onclick="closeAddProject()">Cancel</button>
            <button type="submit" class="btn">Create Project</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script>
    // Enhanced data structure with chat functionality
    let boardData = {
      "columns": [
        {"id": "backlog", "name": "ðŸ“‹ Backlog"},
        {"id": "recurring", "name": "ðŸ”„ Recurring"},
        {"id": "in-progress", "name": "ðŸš§ In Progress"},
        {"id": "done", "name": "âœ… Done"}
      ],
      "tasks": [
        {
          "id": "task-001",
          "title": "Second Brain System",
          "description": "Organize all information Luke shares into categorized knowledge base",
          "column": "recurring",
          "priority": "high",
          "type": "recurring",
          "created": "2026-02-01",
          "context": "Luke requested a second brain to organize all info by: personal life, business, people, context, ideas, active projects. Stored locally on Mac.",
          "archived": false,
          "chatMessages": [
            {
              "id": 1,
              "sender": "system",
              "message": "Project chat initialized. You can now discuss this project directly with Arthur.",
              "timestamp": "2026-02-02T09:30:00"
            }
          ],
          "activity": [
            {"date": "2026-02-01T17:09:00", "action": "Request received", "detail": "Luke: 'I want you to build this out, to organize all information when I share it with you... whether it's my personal life, business life, is it a certain person, is it a certain context, is it an idea, is it like an active project'"},
            {"date": "2026-02-01T17:14:00", "action": "Proposed structure", "detail": "Arthur proposed brain/ folder with: people/, projects/, business/, personal/, ideas/, reference/. Luke approved."},
            {"date": "2026-02-01T17:14:00", "action": "Built folder structure", "detail": "Created brain/{people,projects,business,personal,ideas,reference}/"}
          ]
        },
        {
          "id": "task-002",
          "title": "Enhanced Kanban Board",
          "description": "Visual project management board with integrated chat functionality",
          "column": "in-progress",
          "priority": "high",
          "type": "project",
          "created": "2026-02-02",
          "context": "Luke wants each project card to have a chat interface for direct collaboration with Arthur. Plus add project functionality and archive system.",
          "archived": false,
          "chatMessages": [
            {
              "id": 1,
              "sender": "arthur",
              "message": "Starting work on your enhanced Kanban board! This will include chat integration, add project functionality, and archive system. ðŸ¦ž",
              "timestamp": "2026-02-02T09:30:00"
            }
          ],
          "activity": [
            {"date": "2026-02-02T09:25:00", "action": "Request received", "detail": "Luke: Enhanced Kanban with chat integration per project card, add project functionality, and archive system"},
            {"date": "2026-02-02T09:30:00", "action": "Development started", "detail": "Arthur began building enhanced version with chat functionality"}
          ]
        }
      ],
      "archivedTasks": [],
      "lastUpdated": "2026-02-02T09:30:00"
    };
    
    let currentProjectId = null;
    let activeTab = 'activity';
    
    function formatDate(dateStr) {
      const d = new Date(dateStr);
      return d.toLocaleString('en-US', { 
        month: 'short', day: 'numeric', 
        hour: 'numeric', minute: '2-digit'
      });
    }
    
    function renderBoard() {
      document.getElementById('lastUpdated').textContent = formatDate(boardData.lastUpdated);
      
      const board = document.getElementById('board');
      board.innerHTML = '';
      
      boardData.columns.forEach(col => {
        const tasks = boardData.tasks.filter(t => t.column === col.id && !t.archived);
        
        const colEl = document.createElement('div');
        colEl.className = 'column';
        colEl.innerHTML = `
          <div class="column-header">
            <span>${col.name}</span>
            <span class="column-count">${tasks.length}</span>
          </div>
          <div class="tasks">
            ${tasks.map(task => `
              <div class="task" onclick="showProject('${task.id}')">
                <div class="task-title">${task.title}</div>
                <div class="task-desc">${task.description}</div>
                <div class="task-meta">
                  <span class="tag ${task.priority}">${task.priority}</span>
                  <span class="tag ${task.type}">${task.type}</span>
                </div>
                <div class="task-date">Created ${task.created}</div>
                ${task.chatMessages.length > 1 ? `<div class="chat-indicator">${task.chatMessages.length - 1}</div>` : ''}
              </div>
            `).join('')}
          </div>
        `;
        board.appendChild(colEl);
      });
      
      // Render archived tasks
      const archivedTasks = boardData.archivedTasks;
      document.getElementById('archiveCount').textContent = archivedTasks.length;
      document.getElementById('archivedTasks').innerHTML = archivedTasks.map(task => `
        <div class="task" onclick="showProject('${task.id}')">
          <div class="task-title">${task.title}</div>
          <div class="task-desc">${task.description}</div>
          <div class="task-meta">
            <span class="tag ${task.priority}">${task.priority}</span>
            <span class="tag ${task.type}">${task.type}</span>
          </div>
          <div class="task-date">Archived ${task.archivedDate}</div>
        </div>
      `).join('');
    }
    
    function showProject(taskId) {
      const task = boardData.tasks.find(t => t.id === taskId) || 
                   boardData.archivedTasks.find(t => t.id === taskId);
      if (!task) return;
      
      currentProjectId = taskId;
      document.getElementById('modalTitle').textContent = task.title;
      
      // Show context
      document.getElementById('modalContext').innerHTML = task.context 
        ? `<strong>Context:</strong> ${task.context}`
        : '';
      document.getElementById('modalContext').style.display = task.context ? 'block' : 'none';
      
      // Render activity
      document.getElementById('modalBody').innerHTML = task.activity
        .slice().reverse()
        .map(a => `
          <div class="activity-item">
            <div class="activity-header">
              <div class="activity-dot"></div>
              <div class="activity-main">
                <div class="activity-action">${a.action}</div>
                <div class="activity-date">${formatDate(a.date)}</div>
              </div>
            </div>
            ${a.detail ? `<div class="activity-detail">${a.detail}</div>` : ''}
          </div>
        `).join('');
      
      // Render chat messages
      renderChatMessages(task);
      
      // Switch to activity tab by default
      switchTab('activity');
      
      document.getElementById('modal').classList.add('active');
    }
    
    function renderChatMessages(task) {
      const chatMessages = document.getElementById('chatMessages');
      chatMessages.innerHTML = task.chatMessages.map(msg => {
        if (msg.sender === 'system') {
          return `<div style="text-align: center; color: #6e7681; font-size: 12px; margin: 8px 0;">${msg.message}</div>`;
        }
        return `
          <div class="message ${msg.sender}">
            <div>${msg.message}</div>
            <div class="message-time">${formatDate(msg.timestamp)}</div>
          </div>
        `;
      }).join('');
      
      // Scroll to bottom
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }
    
    function switchTab(tabName) {
      activeTab = tabName;
      
      // Update tab buttons
      document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
      document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');
      
      // Update tab content
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
      document.getElementById(tabName + 'Tab').classList.add('active');
    }
    
    async function sendMessage() {
      const input = document.getElementById('chatInput');
      const message = input.value.trim();
      if (!message || !currentProjectId) return;
      
      const task = boardData.tasks.find(t => t.id === currentProjectId) || 
                   boardData.archivedTasks.find(t => t.id === currentProjectId);
      
      // Add user message
      const userMsg = {
        id: Date.now(),
        sender: 'user',
        message: message,
        timestamp: new Date().toISOString()
      };
      task.chatMessages.push(userMsg);
      
      // Clear input
      input.value = '';
      
      // Re-render chat
      renderChatMessages(task);
      
      // Add typing indicator
      const typingMsg = {
        id: 'typing',
        sender: 'arthur',
        message: 'Arthur is typing...',
        timestamp: new Date().toISOString()
      };
      task.chatMessages.push(typingMsg);
      renderChatMessages(task);
      
      try {
        // Send to OpenClaw API
        const response = await sendToArthur(message, task);
        
        // Remove typing indicator
        task.chatMessages = task.chatMessages.filter(m => m.id !== 'typing');
        
        // Add Arthur's response
        const arthurMsg = {
          id: Date.now() + 1,
          sender: 'arthur',
          message: response,
          timestamp: new Date().toISOString()
        };
        task.chatMessages.push(arthurMsg);
        
      } catch (error) {
        // Remove typing indicator
        task.chatMessages = task.chatMessages.filter(m => m.id !== 'typing');
        
        // Add error message
        const errorMsg = {
          id: Date.now() + 1,
          sender: 'arthur',
          message: 'Sorry, I had trouble processing that message. The connection might be down.',
          timestamp: new Date().toISOString()
        };
        task.chatMessages.push(errorMsg);
      }
      
      renderChatMessages(task);
      renderBoard(); // Update chat indicators
      saveBoardData();
    }
    
    async function sendToArthur(message, task) {
      // Construct context-aware message
      const contextMessage = `[PROJECT: ${task.title}] ${message}

PROJECT CONTEXT: ${task.context || 'No additional context'}

RECENT ACTIVITY: ${task.activity.slice(-2).map(a => `${a.action}: ${a.detail || ''}`).join('; ')}`;
      
      // This would normally call OpenClaw's API
      // For now, return a simulated response
      await new Promise(resolve => setTimeout(resolve, 1000)); // Simulate delay
      
      // Simulated intelligent responses based on project
      if (task.title.includes('Kanban')) {
        return "I'm actively building this enhanced Kanban board right now! The chat integration is working perfectly as you can see. Next I'll add the WebSocket connection to make this real-time. What specific features do you want me to prioritize?";
      } else if (task.title.includes('Brain')) {
        return "The Second Brain system is running and organizing all your information. I can help you search, categorize, or retrieve any info you've shared. What would you like to know?";
      } else {
        return `Got it! I'm here to help with ${task.title}. What do you need assistance with for this project?`;
      }
    }
    
    function clearChat() {
      if (!currentProjectId) return;
      
      if (confirm('Clear all chat messages for this project?')) {
        const task = boardData.tasks.find(t => t.id === currentProjectId) || 
                     boardData.archivedTasks.find(t => t.id === currentProjectId);
        
        // Keep only the system initialization message
        task.chatMessages = task.chatMessages.filter(m => m.sender === 'system');
        renderChatMessages(task);
        renderBoard();
        saveBoardData();
      }
    }
    
    function showAddProject() {
      document.getElementById('addProjectModal').classList.add('active');
    }
    
    function closeAddProject() {
      document.getElementById('addProjectModal').classList.remove('active');
      document.getElementById('addProjectForm').reset();
    }
    
    function toggleArchive() {
      const panel = document.getElementById('archivePanel');
      panel.classList.toggle('active');
    }
    
    function closeModal() {
      document.getElementById('modal').classList.remove('active');
      currentProjectId = null;
    }
    
    // Form submission
    document.getElementById('addProjectForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const newTask = {
        id: 'task-' + Date.now(),
        title: document.getElementById('projectTitle').value,
        description: document.getElementById('projectDesc').value,
        column: 'backlog',
        priority: document.getElementById('projectPriority').value,
        type: document.getElementById('projectType').value,
        created: new Date().toISOString().split('T')[0],
        context: document.getElementById('projectContext').value,
        archived: false,
        chatMessages: [
          {
            id: 1,
            sender: 'system',
            message: 'Project created! You can now discuss this project directly with Arthur.',
            timestamp: new Date().toISOString()
          }
        ],
        activity: [
          {
            date: new Date().toISOString(),
            action: 'Project created',
            detail: `Created by Luke via Enhanced Kanban Board`
          }
        ]
      };
      
      boardData.tasks.push(newTask);
      boardData.lastUpdated = new Date().toISOString();
      
      renderBoard();
      saveBoardData();
      closeAddProject();
      
      // Auto-open the new project
      showProject(newTask.id);
    });
    
    // Chat input handling
    document.getElementById('chatInput').addEventListener('keydown', function(e) {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });
    
    // Modal click outside to close
    document.getElementById('modal').addEventListener('click', (e) => {
      if (e.target.id === 'modal') closeModal();
    });
    
    document.getElementById('addProjectModal').addEventListener('click', (e) => {
      if (e.target.id === 'addProjectModal') closeAddProject();
    });
    
    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeModal();
        closeAddProject();
      }
    });
    
    // Save data to localStorage (in real version, this would sync with OpenClaw)
    function saveBoardData() {
      localStorage.setItem('arthurBoardData', JSON.stringify(boardData));
    }
    
    // Load data from localStorage
    function loadBoardData() {
      const saved = localStorage.getItem('arthurBoardData');
      if (saved) {
        boardData = JSON.parse(saved);
      }
    }
    
    // Initialize
    loadBoardData();
    renderBoard();
  </script>
</body>
</html>