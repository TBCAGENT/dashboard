{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/lukefontaine/.openclaw/workspace/mission-control/src/app/api/ghl/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\n\nconst GHL_API_KEY = process.env.GHL_API_KEY || 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJsb2NhdGlvbl9pZCI6ImEweERVZlN6YWR0MjU2QmJVY2d6IiwidmVyc2lvbiI6MSwiaWF0IjoxNzM1MzEwMDU3NDkwLCJzdWIiOiI1NFJkdUNaenJqNEtMaWJpc0N2ZSJ9.gZjSmKIpqVUOhYrRgK5gBSXVvXqEQB2r3R3pXS3vFpk';\nconst GHL_LOCATION_ID = 'a0xDUfSzadt256BbUcgz';\n\nexport async function GET() {\n  try {\n    // Get SMS count for today\n    const today = new Date().toISOString().split('T')[0];\n    \n    const response = await fetch(`https://services.leadconnectorhq.com/conversations/search?locationId=${GHL_LOCATION_ID}&startDate=${today}&limit=1000`, {\n      headers: {\n        'Authorization': `Bearer ${GHL_API_KEY}`,\n        'Version': '2021-07-28',\n        'Content-Type': 'application/json'\n      }\n    });\n\n    if (!response.ok) {\n      throw new Error(`GHL API error: ${response.status}`);\n    }\n\n    const data = await response.json();\n    \n    // Count SMS messages sent today\n    let smsCount = 0;\n    if (data.conversations) {\n      for (const conversation of data.conversations) {\n        if (conversation.messages) {\n          smsCount += conversation.messages.filter((msg: any) => {\n            return msg.type === 'SMS' && \n                   msg.direction === 'outbound' && \n                   new Date(msg.dateAdded).toISOString().startsWith(today);\n          }).length;\n        }\n      }\n    }\n\n    return NextResponse.json({\n      smsToday: smsCount,\n      timestamp: new Date().toISOString()\n    });\n    \n  } catch (error) {\n    console.error('Error fetching GHL data:', error);\n    return NextResponse.json({\n      error: error instanceof Error ? error.message : 'Unknown error',\n      smsToday: 0,\n      timestamp: new Date().toISOString()\n    }, { status: 500 });\n  }\n}"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW,IAAI;AAC/C,MAAM,kBAAkB;AAEjB,eAAe;IACpB,IAAI;QACF,0BAA0B;QAC1B,MAAM,QAAQ,IAAI,OAAO,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE;QAEpD,MAAM,WAAW,MAAM,MAAM,CAAC,qEAAqE,EAAE,gBAAgB,WAAW,EAAE,MAAM,WAAW,CAAC,EAAE;YACpJ,SAAS;gBACP,iBAAiB,CAAC,OAAO,EAAE,aAAa;gBACxC,WAAW;gBACX,gBAAgB;YAClB;QACF;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,MAAM,IAAI,MAAM,CAAC,eAAe,EAAE,SAAS,MAAM,EAAE;QACrD;QAEA,MAAM,OAAO,MAAM,SAAS,IAAI;QAEhC,gCAAgC;QAChC,IAAI,WAAW;QACf,IAAI,KAAK,aAAa,EAAE;YACtB,KAAK,MAAM,gBAAgB,KAAK,aAAa,CAAE;gBAC7C,IAAI,aAAa,QAAQ,EAAE;oBACzB,YAAY,aAAa,QAAQ,CAAC,MAAM,CAAC,CAAC;wBACxC,OAAO,IAAI,IAAI,KAAK,SACb,IAAI,SAAS,KAAK,cAClB,IAAI,KAAK,IAAI,SAAS,EAAE,WAAW,GAAG,UAAU,CAAC;oBAC1D,GAAG,MAAM;gBACX;YACF;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,UAAU;YACV,WAAW,IAAI,OAAO,WAAW;QACnC;IAEF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,OAAO,iBAAiB,QAAQ,MAAM,OAAO,GAAG;YAChD,UAAU;YACV,WAAW,IAAI,OAAO,WAAW;QACnC,GAAG;YAAE,QAAQ;QAAI;IACnB;AACF"}}]
}