{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///Users/lukefontaine/.openclaw/workspace/mission-control/src/app/api/tiller/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\n\nconst TILLER_SHEET_ID = '1pd1dt64gBni4vAWze9QzhVwsmFMcdBuufW6m_0n-OPw';\n\nexport async function GET() {\n  try {\n    // Get Google token\n    const { exec } = require('child_process');\n    const { promisify } = require('util');\n    const execAsync = promisify(exec);\n    \n    const { stdout: tokenOutput } = await execAsync('bash ~/.openclaw/workspace/scripts/google-token.sh');\n    const token = tokenOutput.trim();\n    \n    // Fetch recent transactions from Tiller sheet\n    const range = 'Transactions!A2:J1000'; // Adjust range as needed\n    const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${TILLER_SHEET_ID}/values/${range}`, {\n      headers: {\n        'Authorization': `Bearer ${token}`,\n        'Content-Type': 'application/json'\n      }\n    });\n\n    if (!response.ok) {\n      throw new Error(`Google Sheets API error: ${response.status}`);\n    }\n\n    const data = await response.json();\n    const rows = data.values || [];\n    \n    // Process transactions (assuming columns: Date, Account, Amount, Description, Category, etc.)\n    const transactions = rows\n      .filter((row: string[]) => row[0] && row[1] && row[2]) // Filter out empty rows\n      .map((row: string[], index: number) => ({\n        id: `txn-${index}`,\n        date: row[0],\n        account: row[1],\n        amount: parseFloat(row[2]) || 0,\n        description: row[3] || '',\n        category: row[4] || 'Other',\n        institution: row[5] || '',\n        accountType: row[6] || ''\n      }))\n      .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime()) // Sort by date desc\n      .slice(0, 50); // Get most recent 50 transactions\n\n    // Calculate summary metrics\n    const now = new Date();\n    const thisMonth = now.getMonth();\n    const thisYear = now.getFullYear();\n    \n    const thisMonthTransactions = transactions.filter(t => {\n      const txnDate = new Date(t.date);\n      return txnDate.getMonth() === thisMonth && txnDate.getFullYear() === thisYear;\n    });\n    \n    const monthlySpend = thisMonthTransactions\n      .filter(t => t.amount < 0) // Only negative (outgoing) amounts\n      .reduce((sum, t) => sum + Math.abs(t.amount), 0);\n\n    // Mock other financial data for now (will enhance later)\n    const summary = {\n      netWorth: 1430000, // From MEMORY.md\n      monthlySpend: Math.round(monthlySpend),\n      liquidAssets: 863000, // From MEMORY.md\n      financialHealth: 'B-'\n    };\n\n    return NextResponse.json({\n      transactions: transactions.slice(0, 20), // Return top 20 for display\n      summary,\n      timestamp: new Date().toISOString()\n    });\n    \n  } catch (error) {\n    console.error('Error fetching Tiller data:', error);\n    \n    // Return mock data as fallback\n    return NextResponse.json({\n      error: error instanceof Error ? error.message : 'Unknown error',\n      transactions: [\n        { id: '1', account: 'Business Platinum •1002', amount: -2745.00, description: 'Office rent', date: '2026-02-11', category: 'Business' },\n        { id: '2', account: 'Chase Sapphire •5406', amount: -45.67, description: 'Uber ride', date: '2026-02-11', category: 'Transportation' },\n        { id: '3', account: 'Amex Gold •2004', amount: -89.23, description: 'Restaurant', date: '2026-02-11', category: 'Dining' },\n      ],\n      summary: {\n        netWorth: 1430000,\n        monthlySpend: 32300,\n        liquidAssets: 863000,\n        financialHealth: 'B-'\n      },\n      timestamp: new Date().toISOString()\n    }, { status: 200 }); // Return 200 even on error for graceful fallback\n  }\n}"],"names":[],"mappings":"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"}}]
}