{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///Users/lukefontaine/.openclaw/workspace/mission-control/src/app/api/email/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { exec } from 'child_process';\nimport { promisify } from 'util';\n\nconst execAsync = promisify(exec);\n\nexport async function GET() {\n  try {\n    // Get today's date in YYYY-MM-DD format\n    const today = new Date().toISOString().split('T')[0];\n    \n    // Use himalaya to count sent emails for today\n    const { stdout } = await execAsync(`himalaya envelope list --folder Sent --size 100`);\n    \n    // Parse the output and count emails sent today\n    const lines = stdout.split('\\n');\n    let emailsToday = 0;\n    \n    for (const line of lines) {\n      if (line.includes(today)) {\n        emailsToday++;\n      }\n    }\n\n    return NextResponse.json({\n      emailsToday,\n      timestamp: new Date().toISOString()\n    });\n    \n  } catch (error) {\n    console.error('Error fetching email data:', error);\n    \n    // Fallback: Try to get rough estimate from workspace logs\n    try {\n      const { stdout: logOutput } = await execAsync(`grep -r \"send-email\" ~/.openclaw/workspace/memory/ | grep \"${new Date().toISOString().split('T')[0]}\" | wc -l`);\n      const fallbackCount = parseInt(logOutput.trim()) || 0;\n      \n      return NextResponse.json({\n        emailsToday: fallbackCount,\n        timestamp: new Date().toISOString(),\n        source: 'fallback'\n      });\n    } catch (fallbackError) {\n      return NextResponse.json({\n        error: error instanceof Error ? error.message : 'Unknown error',\n        emailsToday: 0,\n        timestamp: new Date().toISOString()\n      }, { status: 500 });\n    }\n  }\n}"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEA,MAAM,YAAY,IAAA,8GAAS,EAAC,2HAAI;AAEzB,eAAe;IACpB,IAAI;QACF,wCAAwC;QACxC,MAAM,QAAQ,IAAI,OAAO,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE;QAEpD,8CAA8C;QAC9C,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,UAAU,CAAC,+CAA+C,CAAC;QAEpF,+CAA+C;QAC/C,MAAM,QAAQ,OAAO,KAAK,CAAC;QAC3B,IAAI,cAAc;QAElB,KAAK,MAAM,QAAQ,MAAO;YACxB,IAAI,KAAK,QAAQ,CAAC,QAAQ;gBACxB;YACF;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB;YACA,WAAW,IAAI,OAAO,WAAW;QACnC;IAEF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8BAA8B;QAE5C,0DAA0D;QAC1D,IAAI;YACF,MAAM,EAAE,QAAQ,SAAS,EAAE,GAAG,MAAM,UAAU,CAAC,2DAA2D,EAAE,IAAI,OAAO,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE,CAAC,SAAS,CAAC;YAC7J,MAAM,gBAAgB,SAAS,UAAU,IAAI,OAAO;YAEpD,OAAO,gJAAY,CAAC,IAAI,CAAC;gBACvB,aAAa;gBACb,WAAW,IAAI,OAAO,WAAW;gBACjC,QAAQ;YACV;QACF,EAAE,OAAO,eAAe;YACtB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBACvB,OAAO,iBAAiB,QAAQ,MAAM,OAAO,GAAG;gBAChD,aAAa;gBACb,WAAW,IAAI,OAAO,WAAW;YACnC,GAAG;gBAAE,QAAQ;YAAI;QACnB;IACF;AACF"}}]
}